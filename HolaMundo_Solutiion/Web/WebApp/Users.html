<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Administración de usuarios</title>
</head>
<body>
    <header>
        <h1>Administración de usuarios</h1>
    </header>
    <section>
        <div>
            <label for="NickName">Apodo</label>
            <input id="NickName"
                   name="NickName"
                   type="text" />
        </div>

        <div>
            <label for="Email">Correo electrónico</label>
            <input id="Email" name="Email" type="email" />
        </div>

        <div>
            <label for="Password">Correo electrónico</label>
            <input id="Password" name="Password" type="password" />
        </div>

        <button id="btn-search">Buscar</button>
        <button id="btn-create">Crear</button>
    </section>

    <section>
        <ul id="lista"></ul>
    </section>

    <footer>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded',
            main(event))

        function main(event) {
            var btnSearch = document
                .getElementById("btn-search")
            btnSearch.onclick = buttonSearchClick

            document.getElementById("btn-create")
                .onclick = buttonCreateClick
        }

        function buttonCreateClick() {
            var user = {}
            user.id = 0
            user.email = document.getElementById("Email").value
            user.nickName = document.getElementById("NickName").value
            user.password = document.getElementById("Password").value
            user.relatedModules = []

            var url = "http://localhost:5115/api/User/create"

            execHttprequest("POST"
                , url
                , null, (response) => {
                    var result = JSON.parse(response)
                alert(result.message)
            }, JSON.stringify(user))

            console.log(JSON.stringify(user))
        }

        function buttonSearchClick() {
            var criteria = document
                .getElementById("NickName").value

            if (criteria === '' || criteria === null) {
                criteria = document
                    .getElementById("Email").value
            }

            var url = "http://localhost:5115/api/User/get"
            if (criteria != null && criteria != '') {
                url += "?criteria=" + criteria
            }

            execHttprequest("GET"
                , url
                , null, (response) => {
                    var lista = document.getElementById("lista")
                    lista.innerHTML = ""

                    var result = JSON.parse(response)
                    alert(result.message)

                    result.objectResult.forEach((item) => {
                        lista.innerHTML +=
                            "<li>" + item.nickName + " - " + item.email + "</li>"
                    })
                }, null)
        }

        function execHttprequest(method, url, body
            , callback, params) {
            var request = new XMLHttpRequest()
            request.open(method, url)
            request.setRequestHeader("Content-Type"
                , "application/json;charset=UTF-8");
            request.onload = (e) => {
                callback(request.response)
            }

            request.onerror = (e) => {
                alert(request.status)
            }

            request.send(params)
        }
    </script>
</body>
</html>